<?php
/** @var \Contestio\Connect\ViewModel\RouteChecker $viewModel */
$viewModel = $block->getData('view_model');

if ($viewModel->isContestioRoute() === false) {
  // If not contestio route, do not load React app
  return;
}

try {
  $metaData = $this->getMetaTags();
} catch (Exception $e) {
  $metaData = [];
}

$pageConfig = method_exists($block, 'getPageConfig') ? $block->getPageConfig() : null;
if ($pageConfig) {
  if (!empty($metaData['title'])) {
    $pageConfig->getTitle()->set($metaData['title']);
  }
  if (!empty($metaData['description'])) {
    $pageConfig->setDescription($metaData['description']);
  }
  if (!empty($metaData['canonicalUrl'])) {
    $pageConfig->addRemotePageAsset(
      $metaData['canonicalUrl'],
      'canonical',
      ['attributes' => ['rel' => 'canonical']]
    );
  }
}

// Card type
echo "<meta name='twitter:card' content='summary'>";

// Og url
$ogUrl = isset($metaData['canonicalUrl']) ? $metaData['canonicalUrl'] : (isset($metaData['currentUrl']) ? $metaData['currentUrl'] : null);
if ($ogUrl) {
  echo "<meta property='og:url' content='".$ogUrl."'>";
  echo "<meta property='twitter:url' content='".$ogUrl."'>";
}

// Composer package version
if (isset($metaData['version'])) {
  echo "<meta data-contestio-version='".$metaData['version']."'>";
}

// Open graph and twitter
if (isset($metaData['title'])) {
  echo "<meta property='og:title' content='".$metaData['title']."'>";
  echo "<meta property='twitter:title' content='".$metaData['title']."'>";
}
if (isset($metaData['description'])) {
  echo "<meta property='og:description' content='".$metaData['description']."'>";
  echo "<meta property='twitter:description' content='".$metaData['description']."'>";
}
if (isset($metaData['image'])) {
  echo "<meta property='og:image' content='".$metaData['image']."'>";
  echo "<meta property='twitter:image' content='".$metaData['image']."'>";
}
if (isset($metaData['siteName'])) {
  echo "<meta property='og:site_name' content='".$metaData['siteName']."'>";
  echo "<meta property='twitter:site' content='".$metaData['siteName']."'>";
}

// Custom JS - CSS
if (isset($metaData['customJS'])) {
  echo "<script>".$metaData['customJS']."</script>";
}

?>
